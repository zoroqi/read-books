---
id: 20240321214242_155128dccbb7463a
date: "2024-03-21"
aliases:
- 第二部分 软件的复杂性和它的起因
- 第5章 复杂性的蛛丝马迹
- 第6章 创造复杂性的方法之一：违反你承诺过的API约定
- 第7章 什么时候不值得向后兼容
- 第8章 复杂是牢笼
category:
- read
tags:
tc:
- read
---

## 复杂性的蛛丝马迹

你可以利用以下特征来辨别代码是否过于复杂了：

1. 需要添加“黑客代码（hack）”来保证功能的正常运行。
    > 我更喜欢叫飞线, 没有即特殊的理由不要尝试考虑任何 hack 方案.
2. 总是有其他开发者询问代码的某部分是如何工作的。
3. 总是有其他开发者因为误用了你的代码而导致出现bug。
4. 即使是有经验的开发者也无法立即读懂某行代码。
5. 你害怕修改这一部分代码。
6. 管理层认真考虑雇用一个以上的开发人员来处理一个类或文件。
7. 很难搞清楚应该如何增加新功能。
8. 如何在这部分代码中实现某些东西常常会引起开发者之间的争论。
9. 人们常常对这部分代码做完全没有必要的修改，这通常在代码评审时，或者在变更被合并进入主干分支后才被发现。

## 创造复杂性的方法之一：违反你承诺过的API约定

API是某种形式的承诺：“**你可以放心地完全按照我们描述的方式和我们的程序进行交互**。”可一旦你的产品发布了新版本，并且在新版本中不再支持旧版本API，那就意味着你违反了这种承诺。**在模糊的哲学理论或道德范畴之外来看这件事，这种做法带来的技术层面问题是：它给软件增添了复杂性。**

> [!NOTE]
> 按照 "[[202204151156|语义化管理规范]]" 可能是一个不错的选择.

即便对于你个人来说，维护旧API也是痛苦的，摆脱它能够使工作轻松不少。**但我们在这里谈论的复杂性并非针对你，而是针对其他程序员**。

> [!NOTE]
> 但是我见过很多的开发者更多是在考虑自身.

果你选择违背API约定并且决定不再向后兼容，请别忘了当中的一些API用户永远不会为了适配新的API而更新他们的产品。或许他们只是没有足够的时间和资源来更新他们的代码。或许他们在使用第三方工具来和你的产品进行交互，但是第三方工具的维护者已经不再提供更新了。无论是哪种情况，如果他们修复代码的成本高于适配你的新产品而带来的收益，他们就会依然选择使用你的旧版本产品，甚至永远用下去。

> [!NOTE]
> 这种兼容实际上是一件很痛苦的事情, 所以需要一大笔资金来抚慰这种痛苦.
> API 的设计并不是一次就能决定好的, 个人能力的不足导致的设计问题, 如果不进行修改都会导致越来越难维护.

## 什么时候不值得[[20230930102927#向后兼容]]

本篇标题似乎和前一篇内容相互矛盾……当然，如果条件允许的话，你确实不应该违背API约定。但有的时候保证应用程序的每一个组件都向后兼容会导致收益递减。这个原理不仅对API适用，对整个程序也同样适用。

Perl这门编程语言充斥着对于那些，真的不应该有人再去使用的奇怪语法的支持。举个例子，在Perl中，你本应该用类似于`$object->method()`的方式调用对象上的方法。但是也同时存在一种称为“间接对象语法”的概念，借助它你可以编写`method $object`这样的语句来达到同样效果。注意别把它和`method($object)`混淆了——前者不带括号的用法才是间接对象语法。说真的，没有人应该继续使用那种语法，并且以正确的方式修复程序中调用方法的地方也不是难事。但为了保证向后兼容，该语法在Perl二进制包中一直受到支持并被维护着。

> [!NOTE]
> 过去一段实现在看 fp-go 项目的时候我猜知道 go 中 method 的特殊调用方式, 一般都是 `object.method(p1,p2)`, 而实际上也可以写成 `method(object,p1,p2)`.
> 我是真的没有想到可以这么去调用, 当然这可能是来自于 java 的习惯.

因为总有一天你需要为这些你开发的“尽管没有什么用但加上去很方便”的功能提供向后兼容的支持。这是在添加新功能时需要慎重考虑的一点——既然这个特性已经存在于你的系统中了，那么你打算永远把它维护下去吗？答案是：你很可能需要。

如果你从来没有维护过多人使用的大型系统，你可能对以下两点没有概念：

1. 你不支持向后兼容的决定会导致多少用户遭殃。
2. 如果持续向后兼容你会把自己搞得多狼狈。

**你应该认真考虑放弃向后兼容的唯一时机是，当它在妨碍你添加明显实用且重要的新功能的时候。 如果这种情况确实发生了，那么你就需要放弃向后兼容了。**

## 复杂是牢笼

有时候我认为人们会担心他们的代码过于简单了，因为这样会导致：

1. 他们没法通过某种方式向他们的经理展示出他们有多么地聪明，或多么地有价值。
2. **项目会看上去变得简单许多，似乎任何人都可以替换他们并偷走他们的工作！**
    > 在 2023 年我竟然见过网上出现一种很 SB 的编程技巧, 就是写出无法维护的代码, 来防止自己被裁员.
    
我知道我不想被自己的代码束缚。如果工作带来的安全感对你来说如此重要，以至于为了获得一份工作你愿意将自己永远和它束缚在一起，那么或许你应该重新考虑生活的重心究竟在哪里！除此之外，当你在为你的项目做决定时，请牢记一件事：**复杂是牢笼，简单是自由。**